# Configuración general del framework
app:
  name: "Android Vulnerability Detection Framework"
  version: "1.0.0"
  
# Configuración de logging
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "logs/framework.log"
  console: true

# Módulo 1: Preprocesamiento APK
preprocessing:
  jadx:
    path: "tools/jadx/bin/jadx"
    deobfuscate: true
    threads: 4
  soot:
    android_jars: "tools/android-platforms/"
    output_format: "jimple"
    whole_program: true
  quality_threshold: 0.7  # Umbral mínimo de calidad de descompilación

# Módulo 2: Análisis Taint
taint_analysis:
  # Sources Android-específicos
  sources:
    - "android.location.LocationManager: android.location.Location getLastKnownLocation(java.lang.String)"
    - "android.telephony.TelephonyManager: java.lang.String getDeviceId()"
    - "android.provider.ContactsContract$CommonDataKinds$Phone: android.net.Uri CONTENT_URI"
    - "android.hardware.Camera: void takePicture(*)"
    - "android.media.MediaRecorder: void start()"
  
  # Sinks peligrosos
  sinks:
    - "java.net.HttpURLConnection: void connect()"
    - "okhttp3.OkHttpClient: okhttp3.Call newCall(okhttp3.Request)"
    - "android.util.Log: int d(java.lang.String,java.lang.String)"
    - "android.webkit.WebView: void loadUrl(java.lang.String)"
    - "android.content.Intent: android.content.Intent putExtra(java.lang.String,*)"
  
  # Configuración de análisis
  flow_sensitive: true
  context_sensitive: true
  field_sensitive: true
  lifecycle_aware: true
  max_depth: 10
  timeout_seconds: 300

# Módulo 3: Modelo Transformer
transformer:
  # Modelo base
  model_name: "microsoft/codebert-base"
  model_path: "models/codebert_finetuned/"
  
  # Arquitectura
  num_layers: 6
  num_heads: 8
  hidden_size: 512
  max_sequence_length: 512
  vocab_size_extended: 2000  # APIs Android adicionales
  
  # Embeddings
  embedding_dim: 512
  permission_embedding_dim: 64
  component_embedding_dim: 32
  
  # Entrenamiento
  learning_rate: 2e-5
  warmup_steps: 500
  batch_size: 16
  gradient_accumulation_steps: 2
  max_epochs: 50
  early_stopping_patience: 10
  
  # Regularización
  dropout: 0.3
  weight_decay: 0.01
  gradient_clip_norm: 1.0
  
  # Umbralización
  threshold_critical: 0.75  # Validación dinámica automática
  threshold_high: 0.55      # Reporte + recomendación manual
  threshold_medium: 0.35    # Flagging para análisis posterior
  threshold_low: 0.20       # Logging para monitoreo
  
  # Función de pérdida
  loss_weights:
    bce: 0.4          # Binary Cross Entropy
    ranking: 0.3      # Ranking Loss
    regularization: 0.2
    context: 0.1

# Módulo 4: Validación Dinámica
dynamic_validation:
  # Frida
  frida:
    version: "16.0.0"
    timeout_seconds: 60
    script_path: "modules/dynamic_validation/frida_scripts/"
  
  # Emuladores
  emulator:
    api_level: 30
    arch: "x86_64"
    device: "pixel_3a"
    headless: true
    port_start: 5554
    max_instances: 4
  
  # Estrategia de activación
  activation:
    score_threshold: 0.75
    max_validations_per_apk: 10
    priority_order: "score_desc"  # score_desc, type, random
  
  # Técnicas de testing
  techniques:
    taint_propagation: true
    permission_bypass: true
    communication_security: true
    generate_poc: true
  
  # Marcadores para taint tracking
  markers:
    prefix: "TAINT_MARKER_"
    encoding: "base64"
    length: 32

# Datasets
datasets:
  droidbench:
    path: "datasets/droidbench/"
    version: "3.0"
  ghera:
    path: "datasets/ghera/"
    categories: ["all"]
  androzoo:
    path: "datasets/androzoo/"
    subset_size: 1000
  
  # Augmentación
  augmentation:
    enabled: true
    factor: 3.0  # 300% de incremento
    techniques:
      - "api_substitution"
      - "sequence_permutation"
      - "context_variation"

# Base de datos
database:
  postgres:
    host: "localhost"
    port: 5432
    database: "android_vulns"
    user: "admin"
    password: "${DB_PASSWORD}"  # Variable de entorno
  redis:
    host: "localhost"
    port: 6379
    db: 0
    ttl_seconds: 3600

# Paralelización
parallelization:
  preprocessing_workers: 4
  taint_analysis_workers: 4
  classifier_batch_size: 32
  dynamic_validation_instances: 4

# Evaluación
evaluation:
  metrics:
    - "precision"
    - "recall"
    - "f1_score"
    - "false_positive_rate"
    - "accuracy"
  cross_validation:
    folds: 5
    stratified: true
  statistical_tests:
    - "mcnemar"
    - "wilcoxon"
  
# Exportación de resultados
output:
  formats:
    - "json"
    - "html"
    - "pdf"
  include_evidence: true
  include_poc: true
  detailed_traces: true
